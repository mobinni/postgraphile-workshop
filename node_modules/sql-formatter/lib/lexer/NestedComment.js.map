{"version":3,"file":"NestedComment.js","names":["START","MIDDLE","END","NestedComment","lastIndex","exec","input","result","match","nestLevel","matchSection","regex","matches","length"],"sources":["../../src/lexer/NestedComment.ts"],"sourcesContent":["/* eslint-disable no-cond-assign */\nimport { RegExpLike } from './TokenizerEngine.js';\n\nconst START = /\\/\\*/uy; // matches: /*\nconst MIDDLE = /([^/*]|\\*[^/]|\\/[^*])+/uy; // matches text NOT containing /* or */\nconst END = /\\*\\//uy; // matches: */\n\n/**\n * An object mimicking a regular expression,\n * for matching nested block-comments.\n */\nexport class NestedComment implements RegExpLike {\n  public lastIndex: number = 0;\n\n  public exec(input: string): string[] | null {\n    let result = '';\n    let match: string | null;\n    let nestLevel = 0;\n\n    if ((match = this.matchSection(START, input))) {\n      result += match;\n      nestLevel++;\n    } else {\n      return null;\n    }\n\n    while (nestLevel > 0) {\n      if ((match = this.matchSection(START, input))) {\n        result += match;\n        nestLevel++;\n      } else if ((match = this.matchSection(END, input))) {\n        result += match;\n        nestLevel--;\n      } else if ((match = this.matchSection(MIDDLE, input))) {\n        result += match;\n      } else {\n        return null;\n      }\n    }\n\n    return [result];\n  }\n\n  private matchSection(regex: RegExp, input: string): string | null {\n    regex.lastIndex = this.lastIndex;\n    const matches = regex.exec(input);\n    if (matches) {\n      this.lastIndex += matches[0].length;\n    }\n    return matches ? matches[0] : null;\n  }\n}\n"],"mappings":"AAAA;AAGA,MAAMA,KAAK,GAAG,QAAd,C,CAAwB;;AACxB,MAAMC,MAAM,GAAG,0BAAf,C,CAA2C;;AAC3C,MAAMC,GAAG,GAAG,QAAZ,C,CAAsB;;AAEtB;AACA;AACA;AACA;;AACA,OAAO,MAAMC,aAAN,CAA0C;EACxCC,SAAS,GAAW,CAAX;;EAETC,IAAI,CAACC,KAAD,EAAiC;IAC1C,IAAIC,MAAM,GAAG,EAAb;IACA,IAAIC,KAAJ;IACA,IAAIC,SAAS,GAAG,CAAhB;;IAEA,IAAKD,KAAK,GAAG,KAAKE,YAAL,CAAkBV,KAAlB,EAAyBM,KAAzB,CAAb,EAA+C;MAC7CC,MAAM,IAAIC,KAAV;MACAC,SAAS;IACV,CAHD,MAGO;MACL,OAAO,IAAP;IACD;;IAED,OAAOA,SAAS,GAAG,CAAnB,EAAsB;MACpB,IAAKD,KAAK,GAAG,KAAKE,YAAL,CAAkBV,KAAlB,EAAyBM,KAAzB,CAAb,EAA+C;QAC7CC,MAAM,IAAIC,KAAV;QACAC,SAAS;MACV,CAHD,MAGO,IAAKD,KAAK,GAAG,KAAKE,YAAL,CAAkBR,GAAlB,EAAuBI,KAAvB,CAAb,EAA6C;QAClDC,MAAM,IAAIC,KAAV;QACAC,SAAS;MACV,CAHM,MAGA,IAAKD,KAAK,GAAG,KAAKE,YAAL,CAAkBT,MAAlB,EAA0BK,KAA1B,CAAb,EAAgD;QACrDC,MAAM,IAAIC,KAAV;MACD,CAFM,MAEA;QACL,OAAO,IAAP;MACD;IACF;;IAED,OAAO,CAACD,MAAD,CAAP;EACD;;EAEOG,YAAY,CAACC,KAAD,EAAgBL,KAAhB,EAA8C;IAChEK,KAAK,CAACP,SAAN,GAAkB,KAAKA,SAAvB;IACA,MAAMQ,OAAO,GAAGD,KAAK,CAACN,IAAN,CAAWC,KAAX,CAAhB;;IACA,IAAIM,OAAJ,EAAa;MACX,KAAKR,SAAL,IAAkBQ,OAAO,CAAC,CAAD,CAAP,CAAWC,MAA7B;IACD;;IACD,OAAOD,OAAO,GAAGA,OAAO,CAAC,CAAD,CAAV,GAAgB,IAA9B;EACD;;AAvC8C"}