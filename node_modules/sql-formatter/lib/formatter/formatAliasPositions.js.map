{"version":3,"file":"formatAliasPositions.js","names":["maxLength","formatAliasPositions","query","lines","split","newQuery","i","length","match","aliasLines","push","splitLines","map","line","matches","precedingText","as","alias","aliasMaxLength","replace","repeat","join"],"sources":["../../src/formatter/formatAliasPositions.ts"],"sourcesContent":["import { maxLength } from '../utils.js';\n\n/**\n * Handles select alias placement - tabulates if enabled\n */\nexport default function formatAliasPositions(query: string): string {\n  const lines = query.split('\\n');\n\n  let newQuery: string[] = [];\n  for (let i = 0; i < lines.length; i++) {\n    // find SELECT rows with trailing comma, if no comma (only one row) - no-op\n    if (lines[i].match(/^\\s*SELECT/i)) {\n      let aliasLines: string[] = [];\n      if (lines[i].match(/.*,$/)) {\n        aliasLines = [lines[i]]; // add select to aliasLines in case of tabular formats\n      } else {\n        newQuery.push(lines[i]); // add select to new query\n        if (lines[i].match(/^\\s*SELECT\\s+.+(?!,$)/i)) {\n          continue;\n        }\n        aliasLines.push(lines[++i]);\n      }\n\n      // get all lines in SELECT clause\n      while (lines[i++].match(/.*,$/)) {\n        aliasLines.push(lines[i]);\n      }\n\n      // break lines into alias with optional AS, and all preceding text\n      const splitLines = aliasLines\n        .map(line => ({ line, matches: line.match(/(^.*?\\S) (AS )?(\\S+,?$)/i) }))\n        .map(({ line, matches }) => {\n          if (!matches) {\n            return { precedingText: line };\n          }\n          return {\n            precedingText: matches[1],\n            as: matches[2],\n            alias: matches[3],\n          };\n        });\n\n      // get longest of precedingText, trim trailing comma for non-alias columns\n      const aliasMaxLength = maxLength(\n        splitLines.map(({ precedingText }) => precedingText.replace(/\\s*,\\s*$/, ''))\n      );\n      // re-construct line, aligning by inserting space before AS or alias\n      aliasLines = splitLines.map(\n        ({ precedingText, as, alias }) =>\n          precedingText +\n          (alias ? ' '.repeat(aliasMaxLength - precedingText.length + 1) + (as ?? '') + alias : '')\n      );\n      newQuery = [...newQuery, ...aliasLines];\n    }\n    newQuery.push(lines[i]);\n  }\n\n  return newQuery.join('\\n');\n}\n"],"mappings":"AAAA,SAASA,SAAT,QAA0B,aAA1B;AAEA;AACA;AACA;;AACA,eAAe,SAASC,oBAAT,CAA8BC,KAA9B,EAAqD;EAClE,MAAMC,KAAK,GAAGD,KAAK,CAACE,KAAN,CAAY,IAAZ,CAAd;EAEA,IAAIC,QAAkB,GAAG,EAAzB;;EACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,KAAK,CAACI,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;IACrC;IACA,IAAIH,KAAK,CAACG,CAAD,CAAL,CAASE,KAAT,CAAe,aAAf,CAAJ,EAAmC;MACjC,IAAIC,UAAoB,GAAG,EAA3B;;MACA,IAAIN,KAAK,CAACG,CAAD,CAAL,CAASE,KAAT,CAAe,MAAf,CAAJ,EAA4B;QAC1BC,UAAU,GAAG,CAACN,KAAK,CAACG,CAAD,CAAN,CAAb,CAD0B,CACD;MAC1B,CAFD,MAEO;QACLD,QAAQ,CAACK,IAAT,CAAcP,KAAK,CAACG,CAAD,CAAnB,EADK,CACoB;;QACzB,IAAIH,KAAK,CAACG,CAAD,CAAL,CAASE,KAAT,CAAe,wBAAf,CAAJ,EAA8C;UAC5C;QACD;;QACDC,UAAU,CAACC,IAAX,CAAgBP,KAAK,CAAC,EAAEG,CAAH,CAArB;MACD,CAVgC,CAYjC;;;MACA,OAAOH,KAAK,CAACG,CAAC,EAAF,CAAL,CAAWE,KAAX,CAAiB,MAAjB,CAAP,EAAiC;QAC/BC,UAAU,CAACC,IAAX,CAAgBP,KAAK,CAACG,CAAD,CAArB;MACD,CAfgC,CAiBjC;;;MACA,MAAMK,UAAU,GAAGF,UAAU,CAC1BG,GADgB,CACZC,IAAI,KAAK;QAAEA,IAAF;QAAQC,OAAO,EAAED,IAAI,CAACL,KAAL,CAAW,0BAAX;MAAjB,CAAL,CADQ,EAEhBI,GAFgB,CAEZ,CAAC;QAAEC,IAAF;QAAQC;MAAR,CAAD,KAAuB;QAC1B,IAAI,CAACA,OAAL,EAAc;UACZ,OAAO;YAAEC,aAAa,EAAEF;UAAjB,CAAP;QACD;;QACD,OAAO;UACLE,aAAa,EAAED,OAAO,CAAC,CAAD,CADjB;UAELE,EAAE,EAAEF,OAAO,CAAC,CAAD,CAFN;UAGLG,KAAK,EAAEH,OAAO,CAAC,CAAD;QAHT,CAAP;MAKD,CAXgB,CAAnB,CAlBiC,CA+BjC;;MACA,MAAMI,cAAc,GAAGlB,SAAS,CAC9BW,UAAU,CAACC,GAAX,CAAe,CAAC;QAAEG;MAAF,CAAD,KAAuBA,aAAa,CAACI,OAAd,CAAsB,UAAtB,EAAkC,EAAlC,CAAtC,CAD8B,CAAhC,CAhCiC,CAmCjC;;MACAV,UAAU,GAAGE,UAAU,CAACC,GAAX,CACX,CAAC;QAAEG,aAAF;QAAiBC,EAAjB;QAAqBC;MAArB,CAAD,KACEF,aAAa,IACZE,KAAK,GAAG,IAAIG,MAAJ,CAAWF,cAAc,GAAGH,aAAa,CAACR,MAA/B,GAAwC,CAAnD,KAAyDS,EAAE,IAAI,EAA/D,IAAqEC,KAAxE,GAAgF,EADzE,CAFJ,CAAb;MAKAZ,QAAQ,GAAG,CAAC,GAAGA,QAAJ,EAAc,GAAGI,UAAjB,CAAX;IACD;;IACDJ,QAAQ,CAACK,IAAT,CAAcP,KAAK,CAACG,CAAD,CAAnB;EACD;;EAED,OAAOD,QAAQ,CAACgB,IAAT,CAAc,IAAd,CAAP;AACD"}